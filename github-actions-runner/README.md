# Drew's macOS github-actions-runner role

This installs github-actions-runner suitable for use in CI on macs.

# Usage

## `runner_url`
This points to a repository or organization to attach the runner.
Note that evidently runners cannot be attached to bare users.

## `runner_token`

This is the runner token from the repository or organizations settings->actions page.
This is different than a personal token etc.

Some notes about this:
	1.  They seem to expire after about an hour.  For this reason I wouldn't recommend storing them in secrets per se.
	2.  I have seen some other examples of people using PATs to generate tokens for ansible purposes, although I have not investigated it enough to have an informed opinion, so I just did this.
	3.  If you provide a token, **we assume we need to reconfigure**.  There is probably some way to figure out if reconfiguration is necessary via the API, but [most of the endpoints seem to want `admin:org` permissions](https://docs.github.com/en/free-pro-team@latest/rest/reference/actions#get-a-self-hosted-runner-for-an-organization) which seems kind of excessive permissions for this purpose.  
	4.  If you don't provide a token, we assume you don't want to reconfigure, but in egregious cases, like we detect the system was never configured, you may get an error.

## `labels`

Optional, apply these labels to the runner.

# Implementation

1.  Download and install the latest version
2.  Reconfigure (if possible/necessary), replacing existing configuration if necessary
3.  Labels are a combination of `labels` and `programmatic_labels` (generated by prior roles/tasks.  See the xcode role)
4.  Install/start the runner